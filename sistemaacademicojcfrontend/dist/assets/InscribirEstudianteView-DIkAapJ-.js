import{l as u,m as Y,p as Z,f as K,M as ee,w as z,Q as oe,H as q,o as l,a as o,d as w,c as r,x as k,E as n,D as C,F as V,J as d,Y as v,L as F,n as se,v as ae,Z as T,e as E,q as te}from"./index-BPGklECu.js";const ne={class:"p-6"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re={class:"bg-white p-6 rounded shadow-md"},ie={class:"flex items-center justify-between mb-4"},de={class:"text-xl font-semibold"},ue={key:0,class:"text-gray-500"},pe={class:"overflow-auto max-h-[500px] border rounded"},ce={class:"min-w-full text-sm text-left"},ve=["onClick"],me={class:"px-4 py-2"},_e={class:"px-4 py-2 capitalize"},be={class:"grid md:grid-cols-2 gap-4"},fe={class:"grid md:grid-cols-2 gap-4"},ge={class:"grid md:grid-cols-2 gap-4"},ye={class:"grid md:grid-cols-2 gap-4"},xe=["value"],we={class:"w-full px-4 py-2 border rounded bg-gray-100 text-sm"},ke={class:"flex gap-4"},Ce={key:0,class:"text-green-600"},Ve={key:1,class:"text-red-600"},Ee={class:"bg-white p-6 rounded shadow-md"},Ne={key:0,class:"text-gray-500"},Ue={key:1},$e={class:"mb-4"},qe={class:"mb-4"},Me=["value"],he={key:0,class:"mb-4 text-sm text-gray-600"},je={class:"flex gap-4"},Ie={key:1,class:"mt-4 text-green-600"},Se={key:2,class:"mt-4 text-red-600"},Ae={class:"mb-2"},De={class:"mt-4 flex justify-end"},Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-[rgba(0,0,0,0.3)] backdrop-blur-sm"},Oe={class:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full space-y-4"},Fe={class:"flex justify-end gap-2 mt-4"},Te={class:"flex justify-end mt-4"},ze={__name:"InscribirEstudianteView",setup(Be){const A=u([]),D=u([]),f=u(null),m=u(null),N=u(""),y=u(""),M=u(""),x=u(!1),U=u(!1),G=()=>{U.value=!1,J()},B=u(!1),P=()=>{B.value=Math.random()<.5,U.value=!0},h=u(!1),L=u({usuario:"",password:"admin123"}),_=Y({estudiante_id:"",curso_id:""}),a=u({persona:{nombres_persona:"",apellidos_pat:"",apellidos_mat:"",sexo_persona:"",fecha_nacimiento:"",direccion_persona:"",nacionalidad_persona:"",celular_persona:"",fotografia_persona:null},documento:{carnet_identidad:"",certificado_nacimiento:""},estudiante:{rude:"",libreta_anterior:"",obsev_estudiante:""},inscripcion:{cursos_id_curso:"",gestiones_id_gestion:""}}),j=u(""),$=u(""),O=async()=>{try{const t=await q.get("/info/estudiantes"),e=await q.get("/cursos"),p=await q.get("/gestiones");f.value=p.data.data.find(c=>c.estado_gestion==="activa"),A.value=t.data.estudiantes.filter(c=>!c.cursos.some(i=>{var s;return i.gestiones_id_gestion===((s=f.value)==null?void 0:s.id_gestion)&&i.estado==="inscrito"})),D.value=e.data.data}catch(t){console.error(t),y.value="Error al cargar datos"}};Z(O);const H=t=>{m.value=t,_.estudiante_id=t.id_estudiante,_.curso_id="",N.value="",y.value=""},J=async()=>{var t,e;if(!_.estudiante_id||!_.curso_id||!f.value){y.value="Completa todos los campos antes de inscribir.";return}try{const p={estudiantes_id_estudiante:_.estudiante_id,cursos_id_curso:_.curso_id,gestiones_id_gestion:f.value.id_gestion},c=await q.post("/inscribir-curso",p);N.value=c.data.message,y.value="",m.value=null,O()}catch(p){console.error(p),y.value=((e=(t=p.response)==null?void 0:t.data)==null?void 0:e.message)||"Error al inscribir estudiante",N.value=""}},R=K(()=>{if(!M.value)return A.value;const t=M.value.toLowerCase();return A.value.filter(e=>{const p=e.persona_rol.persona.nombres_persona.toLowerCase(),c=e.persona_rol.persona.apellidos_pat.toLowerCase(),i=e.persona_rol.persona.apellidos_mat.toLowerCase();return p.includes(t)||c.includes(t)||i.includes(t)})}),Q=async()=>{var e,p,c;if(!f.value){$.value="No hay gestión activa definida.";return}const t=a.value;t.inscripcion.cursos_id_curso?t.inscripcion.gestiones_id_gestion=f.value.id_gestion:t.inscripcion={};try{const i=new FormData;console.log("Tipo de fotografia_persona:",t.persona.fotografia_persona);for(const[g,b]of Object.entries(t.persona))b!=null&&i.append(`persona[${g}]`,b);for(const[g,b]of Object.entries(t.documento))i.append(`documento[${g}]`,b);for(const[g,b]of Object.entries(t.estudiante))i.append(`estudiante[${g}]`,b);for(const[g,b]of Object.entries(t.inscripcion))b&&i.append(`inscripcion[${g}]`,b);const s=await q.post("/inscribir-estudiante",i,{headers:{"Content-Type":"multipart/form-data"}});j.value=s.data.message,$.value="",x.value=!1,O();const I=a.value.persona.nombres_persona.trim().split(" ")[0]||"",S=a.value.persona.apellidos_pat.trim()||"";L.value.usuario=`${I}${S}`.toLowerCase(),h.value=!0,W()}catch(i){console.error(i),console.log((e=i.response)==null?void 0:e.data),$.value=((c=(p=i.response)==null?void 0:p.data)==null?void 0:c.message)||"Error al registrar estudiante",j.value=""}},W=()=>{a.value={persona:{nombres_persona:"",apellidos_pat:"",apellidos_mat:"",sexo_persona:"",fecha_nacimiento:"",direccion_persona:"",nacionalidad_persona:"",celular_persona:"",fotografia_persona:null},documento:{carnet_identidad:"",certificado_nacimiento:""},estudiante:{rude:"",libreta_anterior:"",obsev_estudiante:""},inscripcion:{cursos_id_curso:"",gestiones_id_gestion:""}}},X=t=>{const e=t.target.files[0];e&&e.type.startsWith("image/")&&(a.value.persona.fotografia_persona=e)};return(t,e)=>(l(),ee(oe,null,{default:z(()=>{var p,c,i;return[o("div",ne,[e[34]||(e[34]=o("h1",{class:"text-2xl font-bold mb-6"},"Inscripción de Estudiantes",-1)),o("div",le,[o("div",re,[o("div",ie,[o("h2",de,n(x.value?"Registrar nuevo estudiante":"Estudiantes sin curso"),1),w(C,{label:x.value?"Ver lista":"Registrar nuevo estudiante",color:"info",size:"sm",onClick:e[0]||(e[0]=()=>{x.value=!x.value,m.value=null,_.estudiante_id="",_.curso_id=""})},null,8,["label"])]),x.value?(l(),r("form",{key:1,onSubmit:ae(Q,["prevent"]),class:"space-y-4"},[o("div",be,[d(o("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.persona.nombres_persona=s),type:"text",placeholder:"Nombres",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.nombres_persona]]),d(o("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.persona.apellidos_pat=s),type:"text",placeholder:"Apellido paterno",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.apellidos_pat]]),d(o("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.persona.apellidos_mat=s),type:"text",placeholder:"Apellido materno",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.apellidos_mat]]),d(o("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.persona.sexo_persona=s),class:"w-full px-4 py-2 border rounded",required:""},e[24]||(e[24]=[o("option",{value:""},"Seleccionar sexo",-1),o("option",{value:"Masculino"},"Masculino",-1),o("option",{value:"Femenino"},"Femenino",-1)]),512),[[T,a.value.persona.sexo_persona]]),d(o("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.persona.fecha_nacimiento=s),type:"date",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.fecha_nacimiento]]),d(o("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.persona.direccion_persona=s),type:"text",placeholder:"Dirección",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.direccion_persona]]),d(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.persona.nacionalidad_persona=s),type:"text",placeholder:"Nacionalidad",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.nacionalidad_persona]]),d(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.persona.celular_persona=s),type:"text",placeholder:"Celular",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.persona.celular_persona]]),o("input",{type:"file",accept:"image/*",onChange:X,class:"w-full px-4 py-2 border rounded"},null,32)]),o("div",fe,[d(o("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.documento.carnet_identidad=s),type:"text",placeholder:"Carnet de Identidad",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.documento.carnet_identidad]]),d(o("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.documento.certificado_nacimiento=s),type:"text",placeholder:"Certificado de Nacimiento",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.documento.certificado_nacimiento]])]),o("div",ge,[d(o("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.estudiante.rude=s),type:"text",placeholder:"RUDE",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.estudiante.rude]]),d(o("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.estudiante.libreta_anterior=s),type:"text",placeholder:"Libreta anterior",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.estudiante.libreta_anterior]]),d(o("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>a.value.estudiante.obsev_estudiante=s),type:"text",placeholder:"Observaciones",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.estudiante.obsev_estudiante]])]),o("div",ye,[d(o("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>a.value.inscripcion.cursos_id_curso=s),class:"w-full px-4 py-2 border rounded"},[e[25]||(e[25]=o("option",{value:""},"Selecciona curso (opcional)",-1)),(l(!0),r(V,null,F(D.value,s=>(l(),r("option",{key:s.id_curso,value:s.id_curso},n(s.grado_curso)+" "+n(s.paralelo_curso)+" - "+n(s.nivel_educativo.codigo),9,xe))),128))],512),[[T,a.value.inscripcion.cursos_id_curso]]),o("div",we,[e[26]||(e[26]=o("span",null,"Gestión:",-1)),o("strong",null,n(((p=f.value)==null?void 0:p.nombre_gestion)||"No disponible"),1)])]),o("div",ke,[w(C,{type:"submit",label:"Registrar",color:"success"}),w(C,{type:"button",label:"Cancelar",color:"secondary",onClick:e[16]||(e[16]=s=>x.value=!1)})]),j.value?(l(),r("div",Ce,n(j.value),1)):k("",!0),$.value?(l(),r("div",Ve,n($.value),1)):k("",!0)],32)):(l(),r(V,{key:0},[d(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>M.value=s),placeholder:"Buscar por nombre o apellido",class:"w-full mb-4 px-4 py-2 border rounded shadow-sm"},null,512),[[v,M.value]]),R.value.length===0?(l(),r("div",ue," No hay estudiantes encontrados ")):k("",!0),o("div",pe,[o("table",ce,[e[23]||(e[23]=o("thead",{class:"bg-gray-100 sticky top-0"},[o("tr",null,[o("th",{class:"px-4 py-2 font-medium text-gray-600"},"Nombre completo"),o("th",{class:"px-4 py-2 font-medium text-gray-600"},"Estado")])],-1)),o("tbody",null,[(l(!0),r(V,null,F(R.value,s=>{var I,S;return l(),r("tr",{key:s.id_estudiante,onClick:g=>H(s),class:se(["cursor-pointer border-b",((I=m.value)==null?void 0:I.id_estudiante)===s.id_estudiante?"bg-green-100 font-semibold":"hover:bg-gray-100"])},[o("td",me,n(s.persona_rol.persona.nombres_persona)+" "+n(s.persona_rol.persona.apellidos_pat)+" "+n(s.persona_rol.persona.apellidos_mat),1),o("td",_e,n(((S=s.cursos[0])==null?void 0:S.estado)||"No inscrito"),1)],10,ve)}),128))])])])],64))]),o("div",Ee,[e[33]||(e[33]=o("h2",{class:"text-xl font-semibold mb-4"},"Asignar curso",-1)),m.value?(l(),r("div",Ue,[o("div",$e,[o("p",null,[e[27]||(e[27]=o("strong",null,"Nombre:",-1)),E(" "+n(m.value.persona_rol.persona.nombres_persona)+" "+n(m.value.persona_rol.persona.apellidos_pat)+" "+n(m.value.persona_rol.persona.apellidos_mat),1)]),o("p",null,[e[28]||(e[28]=o("strong",null,"CI:",-1)),E(" "+n(((c=m.value.persona_rol.persona.documento)==null?void 0:c.carnet_identidad)||"---"),1)]),o("p",null,[e[29]||(e[29]=o("strong",null,"Estado:",-1)),E(" "+n(((i=m.value.cursos[0])==null?void 0:i.estado)||"no_inscrito"),1)])]),o("div",qe,[e[31]||(e[31]=o("label",{class:"block font-medium mb-1"},"Selecciona curso",-1)),d(o("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>_.curso_id=s),class:"w-full border px-4 py-2 rounded shadow-sm"},[e[30]||(e[30]=o("option",{value:""},"Seleccionar",-1)),(l(!0),r(V,null,F(D.value,s=>(l(),r("option",{key:s.id_curso,value:s.id_curso},n(s.grado_curso)+" "+n(s.paralelo_curso)+" - "+n(s.nivel_educativo.codigo),9,Me))),128))],512),[[T,_.curso_id]])]),f.value?(l(),r("div",he,[e[32]||(e[32]=E(" Gestión activa: ")),o("strong",null,n(f.value.nombre_gestion),1)])):k("",!0),o("div",je,[w(C,{color:"success",label:"Inscribir",onClick:P}),w(C,{color:"info",outline:"",label:"Cancelar",onClick:e[18]||(e[18]=s=>m.value=null)})]),N.value?(l(),r("div",Ie,n(N.value),1)):k("",!0),y.value?(l(),r("div",Se,n(y.value),1)):k("",!0)])):(l(),r("div",Ne," Selecciona un estudiante para continuar. "))])])]),w(te,{modelValue:h.value,"onUpdate:modelValue":e[20]||(e[20]=s=>h.value=s),title:"ALUMNO CREADO EXITOSAMENTE","hide-footer":!0},{default:z(()=>[o("p",Ae,[e[35]||(e[35]=E(" Usuario generado: ")),o("strong",null,n(L.value.usuario),1)]),o("p",null,[e[36]||(e[36]=E(" Contraseña predeterminada: ")),o("strong",null,n(L.value.password),1)]),o("div",De,[w(C,{color:"primary",label:"Aceptar",onClick:e[19]||(e[19]=s=>h.value=!1)})])]),_:1},8,["modelValue"]),U.value?(l(),r("div",Le,[o("div",Oe,[B.value?(l(),r(V,{key:1},[e[38]||(e[38]=o("h2",{class:"text-lg font-bold text-red-600"}," Este estudiante NO aprobó la gestión anterior, no puede inscribirse al curso actual. ",-1)),o("div",Te,[o("button",{onClick:e[22]||(e[22]=s=>U.value=!1),class:"px-4 py-2 text-sm text-white bg-red-600 rounded"}," Cerrar ")])],64)):(l(),r(V,{key:0},[e[37]||(e[37]=o("h2",{class:"text-lg font-bold text-blue-700"}," Este alumno aprobó la gestión anterior, ¿desea inscribirlo? ",-1)),o("div",Fe,[o("button",{onClick:e[21]||(e[21]=s=>U.value=!1),class:"px-4 py-2 text-sm text-gray-700 border rounded hover:bg-gray-100"}," Cancelar "),o("button",{onClick:G,class:"px-4 py-2 text-sm text-white bg-blue-600 rounded"}," Aceptar ")])],64))])])):k("",!0)]}),_:1}))}};export{ze as default};
