import{l as c,m as W,f as re,p as Ve,M as A,w as O,Q as Ee,H as y,o as r,a,d as p,c as u,J as _,Y as S,F as b,L as f,n as se,E as t,x as $,D as g,Z as N,q as D,e as ie}from"./index-mF53A-2o.js";const Ae={class:"p-6"},$e={key:0},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ue={class:"bg-white p-6 rounded shadow-md"},Be={class:"overflow-auto max-h-[500px] border rounded"},Ne={class:"min-w-full text-sm"},De=["onClick"],ze={class:"px-4 py-2"},He={class:"px-4 py-2"},Me={class:"px-4 py-2"},Oe={class:"px-4 py-2"},Se={class:"px-4 py-2"},Te={class:"px-4 py-2"},je={key:1},Ge={key:0,class:"bg-white p-6 rounded shadow-md"},Pe={class:"flex justify-between items-center mb-4"},Re={class:"text-xl font-semibold"},Ie={class:"grid md:grid-cols-2 gap-4 mb-6"},Le=["value"],Fe=["value"],Je=["value"],Qe=["value"],Xe={class:"flex gap-4"},Ye={key:0,class:"text-green-600 mt-2"},Ze={key:1,class:"text-red-600 mt-2"},Ke={key:1,class:"bg-white p-6 rounded shadow-md"},We={class:"flex justify-between items-center mb-4"},ea={class:"text-xl font-semibold"},aa={class:"overflow-auto mb-6"},oa={class:"min-w-full text-sm border"},la={class:"bg-gray-100"},ta={class:"border px-2 py-1 font-medium"},ra=["onClick"],sa={class:"whitespace-pre-wrap text-sm"},ia={class:"grid md:grid-cols-3 gap-4 mb-4"},ua=["value"],na={class:"md:col-span-3"},da=["value"],ca={class:"flex gap-4 mb-4"},va={key:0,class:"overflow-auto border rounded mb-4"},ma={class:"min-w-full text-sm"},pa={class:"px-4 py-2"},_a={class:"px-4 py-2"},ba={class:"px-4 py-2"},fa={class:"px-4 py-2"},ga={class:"flex gap-4"},ya={class:"text-red-700 font-medium"},wa={__name:"AdministrarCursoView",setup(xa){const T=c([]),s=c(null),L=c(!1),V=c(""),x=c(""),j=c(""),m=W({grado_curso:"",paralelo_curso:"",nivel_educativo_id:"",aula_curso:"",turno_curso:"",descripcion:""}),ue=["PRIMERO","SEGUNDO","TERCERO","CUARTO","QUINTO","SEXTO"],ne=["A","B","C","D"],de=["MAÃ‘ANA","TARDE","NOCHE"],F=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes"],d=W({dia:"",hora_inicio:"",hora_fin:"",materias_id_materia:""}),h=c([]),q=c([]),z=c([]),G=c(null),J=W({}),ee=c([]),E=c(!1),k=c(null),w=c(!1),P=c(!1),Q=c(""),R=c(!1),U=c(""),B=c(""),X=c(!1),Y=async()=>{try{const l=await y.get("/admin/cursos");T.value=l.data.data.map(e=>{var i;return{...e,grado_curso:e.grado_curso.toUpperCase(),paralelo_curso:e.paralelo_curso.toUpperCase(),turno_curso:((i=e.turno_curso)==null?void 0:i.toUpperCase())||""}})}catch{x.value="Error al cargar cursos"}},ce=re(()=>{if(!j.value)return T.value;const l=j.value.toUpperCase();return T.value.filter(e=>{var i,n;return e.grado_curso.includes(l)||e.paralelo_curso.includes(l)||((n=(i=e.nivel_educativo)==null?void 0:i.nombre)==null?void 0:n.toUpperCase().includes(l))})}),ve=l=>{s.value=l,Object.assign(m,{grado_curso:l.grado_curso,paralelo_curso:l.paralelo_curso,nivel_educativo_id:l.nivel_educativo_id,aula_curso:l.aula_curso,turno_curso:l.turno_curso,descripcion:l.descripcion}),V.value="",x.value=""},me=async()=>{var l;if(s.value)try{const e=await y.put(`/cursos/${s.value.id_curso}`,m);B.value=e.data.message||"Curso actualizado correctamente.",x.value="",w.value=!0,await Y()}catch(e){((l=e.response)==null?void 0:l.status)===409?(Q.value=e.response.data.message,P.value=!0):(e.value="Error al actualizar el curso.",B.value="")}},pe=async()=>{L.value=!0,await _e(),await be(s.value.nivel_educativo_id),await I(),H()},_e=async()=>{try{const l=await y.get("/gestiones");G.value=l.data.data.find(e=>e.estado_gestion==="activa")}catch(l){console.error("Error al obtener gestiÃ³n activa:",l)}},be=async l=>{try{const e=await y.get("/materias");z.value=e.data.data.filter(i=>i.nivel_educativo_id===l)}catch(e){console.error("Error al cargar materias:",e)}},I=async()=>{try{const l=await y.get(`/cursos/${s.value.id_curso}/horario`);q.value=l.data.data.map(e=>({...e,id:e.id_horario})),console.log("Primer bloque completo:",q.value[0]),console.log("IDs:",q.value.map(e=>e.id))}catch(l){console.error("Error al cargar horario guardado:",l)}},fe=(l,e)=>{var n,o;const i=q.value.find(v=>v.dia===l&&`${v.hora_inicio} - ${v.hora_fin}`===e);i&&(Object.assign(d,{dia:i.dia,hora_inicio:(n=i.hora_inicio)==null?void 0:n.slice(0,5),hora_fin:(o=i.hora_fin)==null?void 0:o.slice(0,5),materias_id_materia:i.materias_id_materia}),k.value=i.id,E.value=!0)},ge=async()=>{if(k.value)try{const l={dia:d.dia,hora_inicio:d.hora_inicio,hora_fin:d.hora_fin,materias_id_materia:d.materias_id_materia,cursos_id_curso:s.value.id_curso,gestiones_id_gestion:G.value.id_gestion};console.log("ðŸŸ¢ Payload enviado al PUT:",l),await y.put(`/horarios/${k.value}`,l),V.value="Bloque actualizado correctamente.",E.value=!1,k.value=null,await I(),H()}catch(l){console.error("Error al actualizar bloque:",l),x.value="No se pudo actualizar el bloque."}},ye=async()=>{if(k.value)try{await y.delete(`/horarios/${k.value}`),V.value="Bloque eliminado correctamente.",E.value=!1,k.value=null,Object.assign(d,{dia:"",hora_inicio:"",hora_fin:"",materias_id_materia:""}),await I(),H()}catch(l){console.error("Error al eliminar bloque:",l),x.value="No se pudo eliminar el bloque."}},xe=()=>{if(!d.dia||!d.hora_inicio||!d.hora_fin||!d.materias_id_materia){alert("Completa todos los campos antes de agregar.");return}h.value.push({...d}),Object.assign(d,{dia:"",hora_inicio:"",hora_fin:"",materias_id_materia:""}),H()},H=()=>{const l={},e=new Set;[...q.value,...h.value].forEach(n=>{var M,oe,le,te;const o=`${n.hora_inicio} - ${n.hora_fin}`;e.add(o),l[n.dia]||(l[n.dia]={});const v=((M=n.materia)==null?void 0:M.sigla_materia)||((oe=z.value.find(K=>K.id_materia===n.materias_id_materia))==null?void 0:oe.sigla_materia)||"MAT",C=((le=n.materia)==null?void 0:le.area_materia)||((te=z.value.find(K=>K.id_materia===n.materias_id_materia))==null?void 0:te.area_materia)||"";l[n.dia][o]=`${v}
${C}`}),J.value=l,ee.value=Array.from(e).sort()},he=(l,e)=>{var i,n;return((n=(i=J.value)==null?void 0:i[l])==null?void 0:n[e])||""},we=async()=>{if(!(!s.value||!G.value))try{const l=h.value.map(e=>({cursos_id_curso:s.value.id_curso,gestiones_id_gestion:G.value.id_gestion,materias_id_materia:e.materias_id_materia,dia:e.dia,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin}));for(const e of l)await y.post("/horarios",e);V.value="Horario guardado exitosamente.",h.value=[],await I(),H()}catch(l){console.error("Error al guardar horario:",l),x.value="No se pudo guardar el horario."}},Z=()=>{s.value=null,L.value=!1,V.value="",x.value="",h.value=[],q.value=[],J.value={},E.value=!1,k.value=null},ke=re(()=>{const l=new Map;return T.value.forEach(e=>{const i=e.nivel_educativo;i&&!l.has(i.id)&&l.set(i.id,i)}),Array.from(l.values())}),Ce=async()=>{var l;if(s.value)try{U.value==="inhabilitar"?(await y.put(`/cursos/${s.value.id_curso}/inhabilitar`),B.value=`Curso "${s.value.grado_curso} ${s.value.paralelo_curso}" inhabilitado correctamente.`,Object.assign(s.value,{estado:"inactivo"}),w.value=!0,Z()):U.value==="reactivar"&&(await y.put(`/cursos/${s.value.id_curso}/reactivar`),B.value=`Curso "${s.value.grado_curso} ${s.value.paralelo_curso}" reactivado correctamente.`,Object.assign(s.value,{estado:"activo"}),w.value=!0),await Y()}catch(e){((l=e.response)==null?void 0:l.status)===409?(Q.value=e.response.data.message,P.value=!0):e.value="Error al realizar la acciÃ³n."}finally{R.value=!1}},ae=l=>{U.value=l,R.value=!0};return Ve(()=>{Y()}),(l,e)=>(r(),A(Ee,null,{default:O(()=>{var i,n;return[a("div",Ae,[e[41]||(e[41]=a("h1",{class:"text-2xl font-bold mb-6"},"Administrar Cursos",-1)),s.value?(r(),u("div",je,[L.value?(r(),u("div",Ke,[a("div",We,[a("h2",ea," Horario de "+t(s.value.grado_curso)+" "+t(s.value.paralelo_curso)+" â€“ Nivel "+t((n=s.value.nivel_educativo)==null?void 0:n.nombre),1),p(g,{label:"Volver",color:"secondary",onClick:Z})]),a("div",aa,[a("table",oa,[a("thead",la,[a("tr",null,[e[33]||(e[33]=a("th",{class:"border px-3 py-2"},"Hora",-1)),(r(),u(b,null,f(F,o=>a("th",{key:o,class:"border px-3 py-2"},t(o),1)),64))])]),a("tbody",null,[(r(!0),u(b,null,f(ee.value,o=>(r(),u("tr",{key:o},[a("td",ta,t(o),1),(r(),u(b,null,f(F,v=>a("td",{key:v+o,class:"border px-2 py-1 text-center cursor-pointer hover:bg-blue-50",onClick:C=>fe(v,o)},[a("pre",sa,t(he(v,o)||"-"),1)],8,ra)),64))]))),128))])])]),a("div",ia,[a("div",null,[e[35]||(e[35]=a("label",{class:"block text-sm font-medium mb-1"},"DÃ­a",-1)),_(a("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>d.dia=o),class:"w-full border px-3 py-2 rounded"},[e[34]||(e[34]=a("option",{disabled:"",value:""},"Seleccione dÃ­a",-1)),(r(),u(b,null,f(F,o=>a("option",{key:o,value:o},t(o),9,ua)),64))],512),[[N,d.dia]])]),a("div",null,[e[36]||(e[36]=a("label",{class:"block text-sm font-medium mb-1"},"Hora Inicio",-1)),_(a("input",{type:"time",step:"60","onUpdate:modelValue":e[11]||(e[11]=o=>d.hora_inicio=o),class:"w-full border px-3 py-2 rounded"},null,512),[[S,d.hora_inicio,void 0,{lazy:!0}]])]),a("div",null,[e[37]||(e[37]=a("label",{class:"block text-sm font-medium mb-1"},"Hora Fin",-1)),_(a("input",{type:"time",step:"60","onUpdate:modelValue":e[12]||(e[12]=o=>d.hora_fin=o),class:"w-full border px-3 py-2 rounded"},null,512),[[S,d.hora_fin,void 0,{lazy:!0}]])]),a("div",na,[e[39]||(e[39]=a("label",{class:"block text-sm font-medium mb-1"},"Materia",-1)),_(a("select",{"onUpdate:modelValue":e[13]||(e[13]=o=>d.materias_id_materia=o),class:"w-full border px-3 py-2 rounded"},[e[38]||(e[38]=a("option",{disabled:"",value:""},"Seleccione materia",-1)),(r(!0),u(b,null,f(z.value,o=>(r(),u("option",{key:o.id_materia,value:o.id_materia},t(o.area_materia)+" ("+t(o.sigla_materia)+") ",9,da))),128))],512),[[N,d.materias_id_materia]])])]),a("div",ca,[E.value?(r(),A(g,{key:0,label:"Actualizar bloque",color:"info",onClick:ge})):$("",!0),E.value?(r(),A(g,{key:1,label:"Eliminar bloque",color:"danger",onClick:ye})):$("",!0),E.value?$("",!0):(r(),A(g,{key:2,label:"Agregar bloque",color:"primary",onClick:xe}))]),h.value.length?(r(),u("div",va,[a("table",ma,[e[40]||(e[40]=a("thead",{class:"bg-gray-100"},[a("tr",null,[a("th",{class:"px-4 py-2 text-left"},"DÃ­a"),a("th",{class:"px-4 py-2 text-left"},"Inicio"),a("th",{class:"px-4 py-2 text-left"},"Fin"),a("th",{class:"px-4 py-2 text-left"},"Materia")])],-1)),a("tbody",null,[(r(!0),u(b,null,f(h.value,(o,v)=>{var C;return r(),u("tr",{key:v},[a("td",pa,t(o.dia),1),a("td",_a,t(o.hora_inicio),1),a("td",ba,t(o.hora_fin),1),a("td",fa,t((C=z.value.find(M=>M.id_materia===o.materias_id_materia))==null?void 0:C.area_materia),1)])}),128))])])])):$("",!0),a("div",ga,[p(g,{label:"Guardar Horario",color:"success",onClick:we}),h.value.length?(r(),A(g,{key:0,label:"Limpiar",color:"warning",onClick:e[14]||(e[14]=o=>h.value=[])})):$("",!0)])])):(r(),u("div",Ge,[a("div",Pe,[a("h2",Re," Editar curso: "+t(s.value.grado_curso)+" "+t(s.value.paralelo_curso),1),p(g,{label:"Cancelar",color:"secondary",onClick:Z})]),a("div",Ie,[a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm font-medium mb-1"},"Grado",-1)),_(a("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>m.grado_curso=o),class:"w-full border px-4 py-2 rounded"},[e[23]||(e[23]=a("option",{disabled:"",value:""},"Seleccione grado",-1)),(r(),u(b,null,f(ue,o=>a("option",{key:o,value:o},t(o),9,Le)),64))],512),[[N,m.grado_curso]])]),a("div",null,[e[26]||(e[26]=a("label",{class:"block text-sm font-medium mb-1"},"Paralelo",-1)),_(a("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>m.paralelo_curso=o),class:"w-full border px-4 py-2 rounded"},[e[25]||(e[25]=a("option",{disabled:"",value:""},"Seleccione paralelo",-1)),(r(),u(b,null,f(ne,o=>a("option",{key:o,value:o},t(o),9,Fe)),64))],512),[[N,m.paralelo_curso]])]),a("div",null,[e[28]||(e[28]=a("label",{class:"block text-sm font-medium mb-1"},"Nivel educativo",-1)),_(a("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>m.nivel_educativo_id=o),class:"w-full border px-4 py-2 rounded"},[e[27]||(e[27]=a("option",{disabled:"",value:""},"Seleccione nivel",-1)),(r(!0),u(b,null,f(ke.value,o=>(r(),u("option",{key:o.id,value:o.id},t(o.nombre),9,Je))),128))],512),[[N,m.nivel_educativo_id]])]),a("div",null,[e[29]||(e[29]=a("label",{class:"block text-sm font-medium mb-1"},"Aula",-1)),_(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>m.aula_curso=o),class:"w-full border px-4 py-2 rounded",placeholder:"Aula"},null,512),[[S,m.aula_curso]])]),a("div",null,[e[31]||(e[31]=a("label",{class:"block text-sm font-medium mb-1"},"Turno",-1)),_(a("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>m.turno_curso=o),class:"w-full border px-4 py-2 rounded"},[e[30]||(e[30]=a("option",{disabled:"",value:""},"Seleccione turno",-1)),(r(),u(b,null,f(de,o=>a("option",{key:o,value:o},t(o),9,Qe)),64))],512),[[N,m.turno_curso]])]),a("div",null,[e[32]||(e[32]=a("label",{class:"block text-sm font-medium mb-1"},"DescripciÃ³n",-1)),_(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>m.descripcion=o),class:"w-full border px-4 py-2 rounded",placeholder:"DescripciÃ³n"},null,512),[[S,m.descripcion]])])]),a("div",Xe,[p(g,{label:"Guardar cambios",color:"success",onClick:e[7]||(e[7]=o=>X.value=!0)}),((i=s.value)==null?void 0:i.estado)==="activo"?(r(),A(g,{key:0,label:"Inhabilitar curso",color:"danger",onClick:e[8]||(e[8]=o=>ae("inhabilitar"))})):(r(),A(g,{key:1,label:"Reactivar curso",color:"warning",onClick:e[9]||(e[9]=o=>ae("reactivar"))})),p(g,{label:"Crear Horario",color:"primary",onClick:pe})]),V.value?(r(),u("div",Ye,t(V.value),1)):$("",!0),x.value?(r(),u("div",Ze,t(x.value),1)):$("",!0)]))])):(r(),u("div",$e,[a("div",qe,[a("div",Ue,[e[22]||(e[22]=a("h2",{class:"text-xl font-semibold mb-4"},"Listado de cursos",-1)),_(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>j.value=o),type:"text",placeholder:"Buscar por grado, nivel o paralelo",class:"w-full mb-4 px-4 py-2 border rounded shadow-sm"},null,512),[[S,j.value]]),a("div",Be,[a("table",Ne,[e[21]||(e[21]=a("thead",{class:"bg-gray-100 sticky top-0"},[a("tr",null,[a("th",{class:"px-4 py-2 text-left"},"Grado"),a("th",{class:"px-4 py-2 text-left"},"Paralelo"),a("th",{class:"px-4 py-2 text-left"},"Nivel"),a("th",{class:"px-4 py-2 text-left"},"Aula"),a("th",{class:"px-4 py-2 text-left"},"Turno"),a("th",{class:"px-4 py-2 text-left"},"Estado")])],-1)),a("tbody",null,[(r(!0),u(b,null,f(ce.value,o=>{var v,C;return r(),u("tr",{key:o.id_curso,onClick:M=>ve(o),class:se(["cursor-pointer",((v=s.value)==null?void 0:v.id_curso)===o.id_curso?"bg-blue-100":"hover:bg-gray-50"])},[a("td",ze,t(o.grado_curso),1),a("td",He,t(o.paralelo_curso),1),a("td",Me,t((C=o.nivel_educativo)==null?void 0:C.nombre),1),a("td",Oe,t(o.aula_curso),1),a("td",Se,t(o.turno_curso),1),a("td",Te,[a("span",{class:se([o.estado==="activo"?"text-green-600":"text-red-600","font-medium"])},t(o.estado),3)])],10,De)}),128))])])])])])]))]),p(D,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=o=>w.value=o),title:"Curso actualizado correctamente",button:"Aceptar",color:"info"},{default:O(()=>{var o,v;return[a("p",null,[e[42]||(e[42]=ie(" El curso ")),a("strong",null,t((o=s.value)==null?void 0:o.grado_curso)+" "+t((v=s.value)==null?void 0:v.paralelo_curso),1),e[43]||(e[43]=ie(" fue editado con Ã©xito. "))])]}),_:1},8,["modelValue"]),p(D,{modelValue:P.value,"onUpdate:modelValue":e[16]||(e[16]=o=>P.value=o),title:"No se puede inhabilitar",color:"danger",button:"Aceptar"},{default:O(()=>[a("p",ya,t(Q.value),1)]),_:1},8,["modelValue"]),p(D,{modelValue:R.value,"onUpdate:modelValue":e[17]||(e[17]=o=>R.value=o),title:U.value==="inhabilitar"?"Â¿Desea inhabilitar este curso?":"Â¿Desea reactivar este curso?",button:U.value==="inhabilitar"?"Inhabilitar":"Reactivar",color:U.value==="inhabilitar"?"danger":"warning",onConfirm:Ce},null,8,["modelValue","title","button","color"]),p(D,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=o=>w.value=o),title:"Ã‰xito",button:"Aceptar",color:"success"},{default:O(()=>[a("p",null,t(B.value),1)]),_:1},8,["modelValue"]),p(D,{modelValue:X.value,"onUpdate:modelValue":e[19]||(e[19]=o=>X.value=o),title:`Â¿Desea guardar los cambios del curso ${m.grado_curso} ${m.paralelo_curso}?`,button:"Guardar",color:"success",onConfirm:me},null,8,["modelValue","title"]),p(D,{modelValue:w.value,"onUpdate:modelValue":e[20]||(e[20]=o=>w.value=o),title:"Curso actualizado",button:"Aceptar",color:"info"},{default:O(()=>[a("p",null,t(B.value),1)]),_:1},8,["modelValue"])]}),_:1}))}};export{wa as default};
