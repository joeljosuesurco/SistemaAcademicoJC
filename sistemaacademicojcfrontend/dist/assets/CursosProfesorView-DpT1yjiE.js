import{l as i,p as T,H as w,f as k,M as j,w as B,Q as R,o as n,a as e,c,x as N,J as O,Y as S,F as _,L as v,E as r,d as b,D as h,e as I,a3 as J}from"./index-Z_uBy7-W.js";const U={class:"p-6"},z={class:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Q={key:0,class:"overflow-x-auto"},Y={class:"min-w-full bg-white border"},G={class:"px-4 py-2 border"},K={class:"px-4 py-2 border"},W={class:"px-4 py-2 border"},X={class:"px-4 py-2 border"},Z={class:"px-4 py-2 border space-x-2"},q={key:1,class:"mt-10"},ee={class:"bg-white border rounded shadow p-6"},se={class:"flex items-center justify-between mb-4"},oe={class:"text-xl font-semibold"},te={class:"overflow-x-auto"},ae={class:"min-w-full bg-white border"},re={class:"px-4 py-2 border text-center"},le={class:"px-4 py-2 border"},ne={class:"px-4 py-2 border"},ce={class:"px-4 py-2 border"},ie={class:"mt-4 flex justify-end"},de={class:"bg-white border rounded shadow p-6"},ue={class:"flex items-center justify-between mb-4"},pe={class:"text-xl font-semibold"},_e={class:"text-gray-700 mb-4"},ve={class:"overflow-x-auto"},be={class:"min-w-full bg-white border rounded"},he={class:"bg-blue-100"},fe={class:"px-4 py-2 border bg-blue-50"},me={key:0,class:"inline-block bg-blue-200 text-blue-900 px-2 py-1 rounded"},ge={__name:"CursosProfesorView",setup(ye){const y=i([]),C=i([]),d=i([]),f=i(""),l=i(null),V=i(null),u=i(!1),p=i(!1),E=["Lunes","Martes","Miércoles","Jueves","Viernes"];T(async()=>{try{const a=await w.get("/profesor-auth/cursos");y.value=a.data.data||[];const s=await w.get("/profesor-auth/horarios");C.value=s.data.data||[]}catch(a){console.error("Error al cargar los datos del profesor:",a)}});const x=k(()=>{const a=new Map;for(const s of y.value)a.has(s.curso.id_curso)||a.set(s.curso.id_curso,s.curso);return Array.from(a.values())}),A=k(()=>f.value?x.value.filter(a=>`${a.grado_curso} ${a.paralelo_curso}`.toLowerCase().includes(f.value.toLowerCase())):x.value),D=async a=>{var s;l.value=a,p.value=!0,u.value=!1,await J(),(s=V.value)==null||s.scrollIntoView({behavior:"smooth"})},M=async a=>{l.value=a,u.value=!0,p.value=!1,d.value=[];try{const s=await w.get(`/profesor-auth/estudiantes-curso/${a.id_curso}`);d.value=s.data.data||[]}catch(s){console.error("Error al cargar estudiantes del curso:",s)}},$=()=>{l.value=null,u.value=!1,p.value=!1},F=k(()=>{if(!l.value)return[];const a=l.value.id_curso,o=y.value.filter(t=>t.curso.id_curso===a).map(t=>t.materia.id_materia);return C.value.filter(t=>t.cursos_id_curso===a&&o.includes(t.materias_id_materia)).map(t=>({dia:t.dia,hora_inicio:t.hora_inicio,hora_fin:t.hora_fin,materia:t.materia}))}),H=async()=>{var o;if(!l.value||!d.value.length){alert("No hay estudiantes para exportar.");return}const a=localStorage.getItem("token"),s="http://136.248.65.246/api/reportes/estudiantes-curso";try{const t=await fetch(s,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json",Accept:"application/pdf"},body:JSON.stringify({curso:{...l.value,nivel:((o=l.value.nivel_educativo)==null?void 0:o.nombre)||"—"},estudiantes:d.value})}),m=t.headers.get("content-type");if(!t.ok||!m.includes("application/pdf")){const P=await t.text();console.error("Respuesta inesperada:",P),alert("No se pudo generar el PDF. Revisa consola.");return}const L=await t.blob(),g=document.createElement("a");g.href=window.URL.createObjectURL(L),g.download=`Estudiantes_${l.value.grado_curso}_${l.value.paralelo_curso}.pdf`,g.click()}catch(t){console.error("Error al descargar PDF:",t),alert("Ocurrió un error al generar el reporte.")}};return(a,s)=>(n(),j(R,null,{default:B(()=>[e("div",U,[s[5]||(s[5]=e("h2",{class:"text-2xl font-bold mb-4"},"Mis Cursos Asignados",-1)),e("div",z,[O(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>f.value=o),placeholder:"Buscar por curso...",class:"w-full md:w-1/3 px-4 py-2 border rounded shadow-sm"},null,512),[[S,f.value]])]),x.value.length&&!u.value&&!p.value?(n(),c("div",Q,[e("table",Y,[s[1]||(s[1]=e("thead",{class:"bg-slate-100"},[e("tr",null,[e("th",{class:"px-4 py-2 border"},"Curso"),e("th",{class:"px-4 py-2 border"},"Nivel"),e("th",{class:"px-4 py-2 border"},"Turno"),e("th",{class:"px-4 py-2 border"},"Aula"),e("th",{class:"px-4 py-2 border"},"Acción")])],-1)),e("tbody",null,[(n(!0),c(_,null,v(A.value,o=>(n(),c("tr",{key:o.id_curso,class:"hover:bg-slate-50"},[e("td",G,r(o.grado_curso)+" "+r(o.paralelo_curso),1),e("td",K,r(o.nivel_educativo.nombre),1),e("td",W,r(o.turno_curso),1),e("td",X,r(o.aula_curso),1),e("td",Z,[b(h,{label:"Ver Horario",color:"info",onClick:t=>D(o)},null,8,["onClick"]),b(h,{label:"Ver Estudiantes",color:"success",onClick:t=>M(o)},null,8,["onClick"])])]))),128))])])])):u.value?(n(),c("div",q,[e("div",ee,[e("div",se,[e("h3",oe," Estudiantes del curso "+r(l.value.grado_curso)+" "+r(l.value.paralelo_curso),1),b(h,{label:"Volver al listado",color:"warning",onClick:$})]),e("div",te,[e("table",ae,[s[2]||(s[2]=e("thead",{class:"bg-green-100"},[e("tr",null,[e("th",{class:"px-4 py-2 border"},"#"),e("th",{class:"px-4 py-2 border"},"Apellido Paterno"),e("th",{class:"px-4 py-2 border"},"Apellido Materno"),e("th",{class:"px-4 py-2 border"},"Nombres")])],-1)),e("tbody",null,[(n(!0),c(_,null,v(d.value,(o,t)=>(n(),c("tr",{key:o.id_estudiante,class:"hover:bg-green-50"},[e("td",re,r(t+1),1),e("td",le,r(o.apellidos_pat),1),e("td",ne,r(o.apellidos_mat),1),e("td",ce,r(o.nombres),1)]))),128))])])]),e("div",ie,[b(h,{label:"Descargar PDF",color:"success",small:"",onClick:H})])])])):p.value?(n(),c("div",{key:2,class:"mt-10",ref_key:"horarioRef",ref:V},[e("div",de,[e("div",ue,[e("h3",pe," Horario de "+r(l.value.grado_curso)+" "+r(l.value.paralelo_curso),1),b(h,{label:"Volver al listado",color:"warning",onClick:$})]),e("p",_e,[s[3]||(s[3]=I(" Nivel educativo: ")),e("strong",null,r(l.value.nivel_educativo.nombre),1)]),e("div",ve,[e("table",be,[e("thead",he,[e("tr",null,[s[4]||(s[4]=e("th",{class:"px-4 py-2 border"},"Hora",-1)),(n(),c(_,null,v(E,o=>e("th",{key:o,class:"px-4 py-2 border"},r(o),1)),64))])]),e("tbody",null,[(n(!0),c(_,null,v(F.value,(o,t)=>(n(),c("tr",{key:t,class:"hover:bg-blue-50"},[e("td",fe,r(o.hora_inicio)+" - "+r(o.hora_fin),1),(n(),c(_,null,v(E,m=>e("td",{key:m,class:"px-4 py-2 border text-center"},[o.dia===m&&o.materia?(n(),c("span",me,r(o.materia.sigla_materia),1)):N("",!0)])),64))]))),128))])])])])],512)):N("",!0)])]),_:1}))}};export{ge as default};
