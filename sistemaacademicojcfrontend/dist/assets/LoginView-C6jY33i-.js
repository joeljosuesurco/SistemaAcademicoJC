import{f as U,g as z,h as N,i as R,j as T,k as j,c as g,o as _,r as C,n as E,_ as F,l as d,m as O,p as G,d as a,w as n,q,F as J,s as L,t as H,v as K,a as l,x as S,u as v,y as Q,z as W,A as X,B as Y,C as Z,D as V,E as $,G as ee,H as ae,I as oe}from"./index-Z_uBy7-W.js";import{_ as B,a as I}from"./FormControl-C6VaIadx.js";const se="/login-image.png",te={__name:"SectionFullScreen",props:{bg:{type:String,required:!0,validator:c=>["purplePink","pinkRed","turquoise"].includes(c)}},setup(c){const m=c,p=U(()=>{if(z().isEnabled)return N;switch(m.bg){case"purplePink":return j;case"pinkRed":return T;case"turquoise":return R}return""});return(b,r)=>(_(),g("div",{class:E(["flex min-h-screen items-center justify-center",p.value])},[C(b.$slots,"default",{cardClass:"w-11/12 md:w-7/12 lg:w-6/12 xl:w-4/12 shadow-2xl"})],2))}},le={},ne={class:"bg-gray-50 dark:bg-slate-800 dark:text-slate-100"};function re(c,m){return _(),g("div",ne,[C(c.$slots,"default")])}const ie=F(le,[["render",re]]),ue={class:"flex flex-col md:flex-row w-full"},de={class:"w-full md:w-1/2 p-4"},ce={key:0,class:"text-center text-orange-500 font-semibold text-sm mb-4"},me={key:1,class:"mt-4 w-full text-center"},pe={class:"text-red-500 text-sm mb-1"},fe={class:"w-full bg-gray-200 rounded h-2 overflow-hidden"},_e={__name:"LoginView",setup(c){const m=d(!1),p=d(!1),b=d(""),r=O({login:"",pass:"",remember:!0}),w=d(!1),i=d(0),o=d(!1),u=d(0);let h=null;const k=L(),D=()=>{const e=Date.now()+5*60*1e3;localStorage.setItem("bloqueo_login",JSON.stringify({desbloqueoEn:e})),u.value=300,o.value=!0,h=setInterval(()=>{const t=Date.now(),s=Math.floor((e-t)/1e3);s<=0?x():u.value=s},1e3)},x=()=>{clearInterval(h),o.value=!1,u.value=0,i.value=0,localStorage.removeItem("bloqueo_login")},P=()=>{const f=localStorage.getItem("bloqueo_login");if(!f)return;const{desbloqueoEn:e}=JSON.parse(f),t=Date.now(),s=Math.floor((e-t)/1e3);s>0?(u.value=s,o.value=!0,h=setInterval(()=>{const A=Date.now(),y=Math.floor((e-A)/1e3);y<=0?x():u.value=y},1e3)):x()};G(()=>{P()});const M=async()=>{if(!o.value)try{const e=(await ae.post("/login",{name_user:r.login,password:r.pass})).data.token;if(!e)throw new Error("Token no recibido");localStorage.setItem("token",e),oe.defaults.headers.common.Authorization=`Bearer ${e}`,m.value=!0,i.value=0,localStorage.removeItem("bloqueo_login"),setTimeout(()=>{k.push("/dashboard")},2e3)}catch{i.value++,b.value="Usuario y/o Contraseña incorrecto",p.value=!0,i.value>=3&&D()}};return(f,e)=>(_(),g(J,null,[a(ie,null,{default:n(()=>[a(te,{bg:"turquoise"},{default:n(({cardClass:t})=>[a(H,{class:E(t),"is-form":"",onSubmit:K(M,["prevent"])},{default:n(()=>[l("div",ue,[e[6]||(e[6]=l("div",{class:"hidden md:flex w-full md:w-1/2 items-center justify-center bg-white p-4"},[l("img",{src:se,alt:"Bienvenido",class:"max-h-64 object-contain"})],-1)),l("div",de,[o.value?(_(),g("p",ce," ⚠️ Demasiados intentos. Tu acceso ha sido bloqueado por 5 minutos. ")):S("",!0),a(B,{label:"Usuario",help:o.value?`Bloqueado: espera ${u.value} seg`:"Por favor ingrese su usuario"},{default:n(()=>[a(I,{modelValue:r.login,"onUpdate:modelValue":e[0]||(e[0]=s=>r.login=s),icon:v(Q),name:"login",autocomplete:"username",disabled:o.value},null,8,["modelValue","icon","disabled"])]),_:1},8,["help"]),a(B,{label:"Contraseña",help:o.value?`Bloqueado: espera ${u.value} seg`:"Por favor ingrese su contraseña"},{default:n(()=>[a(I,{modelValue:r.pass,"onUpdate:modelValue":e[1]||(e[1]=s=>r.pass=s),icon:v(Y),"append-icon":w.value?v(W):v(X),type:w.value?"text":"password",name:"password",autocomplete:"current-password",disabled:o.value,onAppendIconClick:e[2]||(e[2]=s=>w.value=!w.value)},null,8,["modelValue","icon","append-icon","type","disabled"])]),_:1},8,["help"]),a(Z,null,{default:n(()=>[a(V,{type:"submit",color:"info",label:"Ingresar",disabled:o.value},null,8,["disabled"]),a(V,{color:"light",label:"Cancelar",onClick:e[3]||(e[3]=s=>v(k).push("/"))})]),_:1}),i.value>0&&!o.value?(_(),g("div",me,[l("p",pe," Intentos fallidos: "+$(i.value)+" de 3 ",1),l("div",fe,[l("div",{class:"bg-red-500 h-2 transition-all duration-300",style:ee({width:i.value/3*100+"%"})},null,4)])])):S("",!0)])])]),_:2},1032,["class"])]),_:1})]),_:1}),a(q,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value=t),title:"¡Bienvenido!",button:"success"},{default:n(()=>e[7]||(e[7]=[l("p",null,"Inicio de sesión exitoso",-1)])),_:1},8,["modelValue"]),a(q,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),title:"Error de autenticación",button:"danger"},{default:n(()=>[l("p",null,$(b.value),1)]),_:1},8,["modelValue"])],64))}};export{_e as default};
