import{l as p,p as F,H as R,f as D,M as j,w as E,Q as A,o as c,a as e,c as u,F as w,L as y,E as a,d as b,D as k,J as B,Z as O,t as L,x as U,e as i}from"./index-mF53A-2o.js";const H={class:"p-6"},J={key:0},z={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},G=["onClick"],I={class:"font-semibold"},Q={class:"text-sm text-gray-600"},Z={class:"text-sm text-gray-600"},q={key:1},K={class:"mb-4"},W={class:"text-xl font-semibold mb-4"},X={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},Y=["onClick"],ee={class:"font-semibold"},se={class:"text-sm text-gray-600"},te={key:2},ae={class:"mb-4 flex justify-between items-center"},oe={class:"text-xl font-semibold mb-4"},re={class:"overflow-x-auto"},le={class:"w-full text-center bg-white rounded shadow text-sm"},ie={class:"p-2 font-medium"},ne={class:"p-2"},ce={class:"text-xs text-gray-500"},de={class:"p-2"},ue={class:"text-xs text-gray-500"},_e={class:"p-2"},pe={class:"text-xs text-gray-500"},me={class:"p-2"},ve={class:"text-xs text-gray-500"},ge={class:"p-2 text-purple-800"},be={class:"text-xs text-gray-500"},he={class:"p-2 text-purple-800"},xe={class:"text-xs text-gray-500"},fe={class:"p-2 font-bold text-blue-700"},we={key:0,class:"text-gray-500 mt-4"},ye={class:"mt-4 flex justify-end"},Se={__name:"NotasProfesorView",setup(ke){const m=p([]),$=p([]),l=p(null),n=p(null),v=p(1);F(async()=>{try{const o=await R.get("/profesor-auth/notas");m.value=o.data.data;const t=new Map;m.value.forEach(s=>{const d=`${s.curso.id_curso}-${s.gestion.id_gestion}`;t.has(d)||t.set(d,{id_curso:s.curso.id_curso,nombre:`${s.curso.grado_curso} ${s.curso.paralelo_curso}`,nivel:s.curso.nivel_educativo.nombre,gestion:s.gestion.gestion,id_gestion:s.gestion.id_gestion})}),$.value=Array.from(t.values())}catch(o){console.error("Error al cargar notas:",o)}});const M=o=>{l.value=o,n.value=null},V=D(()=>{if(!l.value)return[];const o=new Map;return m.value.forEach(t=>{t.curso.id_curso===l.value.id_curso&&t.gestion.id_gestion===l.value.id_gestion&&(o.has(t.materia.id_materia)||o.set(t.materia.id_materia,{id_materia:t.materia.id_materia,sigla:t.materia.sigla_materia,area:t.materia.area_materia,campo:t.materia.campo_materia}))}),Array.from(o.values())}),P=o=>{n.value=o},g=D(()=>!l.value||!n.value?[]:m.value.filter(o=>o.curso.id_curso===l.value.id_curso&&o.gestion.id_gestion===l.value.id_gestion&&o.materia.id_materia===n.value.id_materia&&String(o.numero_periodo)===String(v.value)).map(o=>{var S;const t=new Map(o.dimensiones.map(_=>[_.nombre_dimension,_])),s=(_,f)=>{var C;const N=((C=t.get(_))==null?void 0:C.valor_obtenido)||0;return{raw:N,calculado:Math.round(N*f/100)}},d=((S=o.estudiante.persona_rol)==null?void 0:S.persona)||{},h=`${d.apellidos_pat||""} ${d.apellidos_mat||""} ${d.nombres_persona||""}`.trim(),r={ser:s("ser_docente",5),saber:s("saber_docente",45),hacer:s("hacer_docente",40),decidir:s("decidir_docente",5),ser_auto:s("ser_autoeval",5),decidir_auto:s("decidir_autoeval",5)},x=Object.values(r).reduce((_,f)=>_+f.calculado,0);return{id_nota:o.id_nota,estudiante:h,ser_raw:r.ser.raw,saber_raw:r.saber.raw,hacer_raw:r.hacer.raw,decidir_raw:r.decidir.raw,ser_auto_raw:r.ser_auto.raw,decidir_auto_raw:r.decidir_auto.raw,ser:r.ser.calculado,saber:r.saber.calculado,hacer:r.hacer.calculado,decidir:r.decidir.calculado,ser_auto:r.ser_auto.calculado,decidir_auto:r.decidir_auto.calculado,promedio:Math.min(x,100)}})),T=async()=>{if(!l.value||!n.value||!g.value.length){alert("No hay datos suficientes para generar el reporte.");return}const o=localStorage.getItem("token"),t="http://136.248.77.161:8000/api/reportes/notas-profesor";try{const s=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json",Accept:"application/pdf"},body:JSON.stringify({curso:l.value,materia:n.value,periodo:v.value,notas:g.value})}),d=s.headers.get("content-type");if(!s.ok||!d.includes("application/pdf")){const x=await s.text();console.error("Respuesta inesperada:",x),alert("No se pudo generar el PDF. Ver consola.");return}const h=await s.blob(),r=document.createElement("a");r.href=window.URL.createObjectURL(h),r.download=`Reporte_Notas_${l.value.nombre}_${n.value.sigla}.pdf`,r.click()}catch(s){console.error("Error al descargar reporte:",s),alert("Ocurrió un error al generar el reporte.")}};return(o,t)=>(c(),j(A,null,{default:E(()=>[e("div",H,[t[7]||(t[7]=e("h2",{class:"text-2xl font-bold mb-6"},"Notas de mis Estudiantes",-1)),l.value?n.value?(c(),u("div",te,[e("div",ae,[e("div",null,[b(k,{label:"Volver a materias",color:"green",small:"",onClick:t[1]||(t[1]=s=>n.value=null)})]),e("div",null,[t[5]||(t[5]=e("label",{class:"mr-2 font-medium"},"Periodo:",-1)),B(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),class:"px-3 py-2 border rounded shadow-sm"},t[4]||(t[4]=[e("option",{value:"1"},"Trimestre 1",-1),e("option",{value:"2"},"Trimestre 2",-1),e("option",{value:"3"},"Trimestre 3",-1)]),512),[[O,v.value]])])]),b(L,{class:"mt-4"},{default:E(()=>[e("h3",oe," Estudiantes de "+a(l.value.nombre)+" – "+a(n.value.area)+" ("+a(n.value.sigla)+") ",1),e("div",re,[e("table",le,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",{class:"bg-white align-middle",rowspan:"3"},"Estudiante"),e("th",{class:"bg-blue-100 text-blue-800 font-semibold",colspan:"4"}," Evaluación Maestro(a) "),e("th",{class:"bg-purple-100 text-purple-800 font-semibold",colspan:"2"}," Autoevaluación "),e("th",{class:"bg-blue-50 font-semibold align-middle",rowspan:"3"},"Promedio")]),e("tr",null,[e("th",{class:"bg-blue-200 text-blue-800 font-medium",colspan:"4"},"Dimensiones"),e("th",{class:"bg-purple-200 text-purple-800 font-medium",colspan:"2"},"Dimensiones")]),e("tr",{class:"text-blue-800"},[e("th",null,[i("Ser"),e("br"),e("span",{class:"text-xs font-normal"},"(5 pts.)")]),e("th",null,[i("Saber"),e("br"),e("span",{class:"text-xs font-normal"},"(45 pts.)")]),e("th",null,[i("Hacer"),e("br"),e("span",{class:"text-xs font-normal"},"(40 pts.)")]),e("th",null,[i("Decidir"),e("br"),e("span",{class:"text-xs font-normal"},"(5 pts.)")]),e("th",{class:"text-purple-700"},[i(" Ser"),e("br"),e("span",{class:"text-xs font-normal"},"(5 pts.)")]),e("th",{class:"text-purple-700"},[i(" Decidir"),e("br"),e("span",{class:"text-xs font-normal"},"(5 pts.)")])])],-1)),e("tbody",null,[(c(!0),u(w,null,y(g.value,s=>(c(),u("tr",{key:s.id_nota,class:"hover:bg-gray-50"},[e("td",ie,a(s.estudiante),1),e("td",ne,[i(a(s.ser_raw),1),e("span",ce," ("+a(s.ser)+")",1)]),e("td",de,[i(a(s.saber_raw),1),e("span",ue," ("+a(s.saber)+")",1)]),e("td",_e,[i(a(s.hacer_raw),1),e("span",pe," ("+a(s.hacer)+")",1)]),e("td",me,[i(a(s.decidir_raw),1),e("span",ve," ("+a(s.decidir)+")",1)]),e("td",ge,[i(a(s.ser_auto_raw),1),e("span",be," ("+a(s.ser_auto)+")",1)]),e("td",he,[i(a(s.decidir_auto_raw),1),e("span",xe," ("+a(s.decidir_auto)+")",1)]),e("td",fe,a(s.promedio),1)]))),128))])])]),g.value.length?U("",!0):(c(),u("div",we," No hay notas registradas para este periodo. "))]),_:1}),e("div",ye,[b(k,{label:"Descargar Reporte PDF",color:"success",small:"",onClick:T})])])):(c(),u("div",q,[e("div",K,[b(k,{label:"Volver a cursos",color:"green",small:"",onClick:t[0]||(t[0]=s=>l.value=null)})]),e("h3",W," Seleccione una materia del curso "+a(l.value.nombre),1),e("div",X,[(c(!0),u(w,null,y(V.value,s=>(c(),u("div",{key:s.id_materia,class:"p-4 border rounded shadow hover:bg-blue-50 cursor-pointer",onClick:d=>P(s)},[e("p",ee,a(s.area)+" ("+a(s.sigla)+")",1),e("p",se,"Campo: "+a(s.campo),1)],8,Y))),128))])])):(c(),u("div",J,[t[3]||(t[3]=e("h3",{class:"text-lg font-semibold mb-2"},"Seleccione un curso",-1)),e("div",z,[(c(!0),u(w,null,y($.value,s=>(c(),u("div",{key:s.id_curso,class:"p-4 border rounded shadow hover:bg-slate-50 cursor-pointer",onClick:d=>M(s)},[e("p",I,a(s.nombre),1),e("p",Q,"Nivel: "+a(s.nivel),1),e("p",Z,"Gestión: "+a(s.gestion),1)],8,G))),128))])]))])]),_:1}))}};export{Se as default};
