import{l as n,p as q,H as _,O as z,f as L,M as Q,w as T,Q as U,o as u,a as s,c as p,x as j,J as S,Y as N,F as $,L as P,n as V,E as l,d as m,D as b,e as J}from"./index-DqMIVmN9.js";const O={class:"p-6"},R={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y={class:"bg-white p-6 rounded shadow-md"},G={class:"overflow-auto max-h-96 border rounded"},I={class:"min-w-full text-sm"},K=["onClick"],W={class:"px-4 py-2"},X={class:"flex justify-between items-center mt-2"},Z={class:"bg-white p-6 rounded shadow-md"},ee={class:"overflow-auto max-h-96 border rounded"},ae={class:"min-w-full text-sm"},se=["onClick"],te={class:"px-4 py-2"},oe={class:"flex justify-between items-center mt-2"},le={class:"mt-6 flex items-center gap-4"},re={key:0,class:"mt-6 bg-white p-6 rounded shadow-md"},ne={class:"text-xl font-semibold mb-4"},de={class:"text-blue-600 font-bold"},ie={class:"overflow-auto max-h-96 border rounded"},ue={class:"min-w-full text-sm"},ce={class:"px-4 py-2"},pe={class:"px-4 py-2"},ve={key:1,class:"mt-4 text-green-600"},_e={key:2,class:"mt-4 text-red-600"},y=5,ge={__name:"AsignarHijosPadreView",setup(me){const C=n([]),f=n([]),g=n([]),r=n(null),x=n(null),v=n(""),c=n(""),d=n(""),i=n(""),w=n(1),h=n(1);q(async()=>{try{const o=await _.get("/padres"),e=await _.get("/info/estudiantes");C.value=o.data.data,f.value=e.data.estudiantes||e.data}catch(o){console.error(o),c.value="No se pudo cargar la información"}}),z(r,async o=>{if(o)try{const e=await _.get(`/padres/${o.id_padre}/hijos`);g.value=e.data.data}catch(e){console.error(e),g.value=[]}else g.value=[]});const B=L(()=>{const o=d.value?C.value.filter(a=>{const t=a.persona_rol.persona;return t.nombres_persona.toLowerCase().includes(d.value.toLowerCase())||t.apellidos_pat.toLowerCase().includes(d.value.toLowerCase())||t.apellidos_mat.toLowerCase().includes(d.value.toLowerCase())}):C.value,e=(w.value-1)*y;return o.slice(e,e+y)}),H=L(()=>{const o=i.value?f.value.filter(a=>{const t=a.persona_rol.persona;return t.nombres_persona.toLowerCase().includes(i.value.toLowerCase())||t.apellidos_pat.toLowerCase().includes(i.value.toLowerCase())||t.apellidos_mat.toLowerCase().includes(i.value.toLowerCase())}):f.value,e=(h.value-1)*y;return o.slice(e,e+y)}),A=L(()=>{const o=d.value?C.value.filter(e=>{const a=e.persona_rol.persona;return a.nombres_persona.toLowerCase().includes(d.value.toLowerCase())||a.apellidos_pat.toLowerCase().includes(d.value.toLowerCase())||a.apellidos_mat.toLowerCase().includes(d.value.toLowerCase())}):C.value;return Math.ceil(o.length/y)}),E=L(()=>{const o=i.value?f.value.filter(e=>{const a=e.persona_rol.persona;return a.nombres_persona.toLowerCase().includes(i.value.toLowerCase())||a.apellidos_pat.toLowerCase().includes(i.value.toLowerCase())||a.apellidos_mat.toLowerCase().includes(i.value.toLowerCase())}):f.value;return Math.ceil(o.length/y)}),M=async()=>{var o,e;if(!r.value||!x.value){c.value="Debes seleccionar tanto un padre como un estudiante";return}try{const a={padres_id_padre:r.value.id_padre,estudiantes_id_estudiante:x.value.id_estudiante},t=await _.post(`/padres/${a.padres_id_padre}/asignar-hijos`,a);v.value=t.data.message,c.value="";const k=await _.get(`/padres/${a.padres_id_padre}/hijos`);g.value=k.data.data}catch(a){console.error(a),c.value=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Error al asignar hijo",v.value=""}},D=async o=>{var e,a;if(r.value)try{await _.delete(`/padres/${r.value.id_padre}/quitar-hijo/${o}`),v.value="Relación eliminada correctamente.",c.value="";const t=await _.get(`/padres/${r.value.id_padre}/hijos`);g.value=t.data.data}catch(t){console.error(t),c.value=((a=(e=t.response)==null?void 0:e.data)==null?void 0:a.message)||"Error al quitar hijo",v.value=""}},F=()=>{r.value=null,x.value=null,v.value="",c.value=""};return(o,e)=>(u(),Q(U,null,{default:T(()=>[s("div",O,[e[12]||(e[12]=s("h1",{class:"text-2xl font-bold mb-6"},"Asignar Hijos a Padres",-1)),s("div",R,[s("div",Y,[e[7]||(e[7]=s("h2",{class:"text-xl font-semibold mb-4"},"Seleccionar Padre",-1)),S(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),type:"text",placeholder:"Buscar padre...",class:"mb-2 w-full px-4 py-2 border rounded shadow-sm"},null,512),[[N,d.value]]),s("div",G,[s("table",I,[e[6]||(e[6]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2"},"Nombre")])],-1)),s("tbody",null,[(u(!0),p($,null,P(B.value,a=>{var t;return u(),p("tr",{key:a.id_padre,onClick:k=>r.value=a,class:V(["cursor-pointer",((t=r.value)==null?void 0:t.id_padre)===a.id_padre?"bg-blue-100":"hover:bg-gray-50"])},[s("td",W,l(a.persona_rol.persona.nombres_persona)+" "+l(a.persona_rol.persona.apellidos_pat)+" "+l(a.persona_rol.persona.apellidos_mat),1)],10,K)}),128))])])]),s("div",X,[m(b,{label:"« Anterior",disabled:w.value===1,onClick:e[1]||(e[1]=a=>w.value--),small:""},null,8,["disabled"]),s("span",null,"Página "+l(w.value)+" de "+l(A.value),1),m(b,{label:"Siguiente »",disabled:w.value===A.value,onClick:e[2]||(e[2]=a=>w.value++),small:""},null,8,["disabled"])])]),s("div",Z,[e[9]||(e[9]=s("h2",{class:"text-xl font-semibold mb-4"},"Seleccionar Estudiante",-1)),S(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>i.value=a),type:"text",placeholder:"Buscar estudiante...",class:"mb-2 w-full px-4 py-2 border rounded shadow-sm"},null,512),[[N,i.value]]),s("div",ee,[s("table",ae,[e[8]||(e[8]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2"},"Nombre")])],-1)),s("tbody",null,[(u(!0),p($,null,P(H.value,a=>{var t;return u(),p("tr",{key:a.id_estudiante,onClick:k=>x.value=a,class:V(["cursor-pointer",((t=x.value)==null?void 0:t.id_estudiante)===a.id_estudiante?"bg-green-100":"hover:bg-gray-50"])},[s("td",te,l(a.persona_rol.persona.nombres_persona)+" "+l(a.persona_rol.persona.apellidos_pat)+" "+l(a.persona_rol.persona.apellidos_mat),1)],10,se)}),128))])])]),s("div",oe,[m(b,{label:"« Anterior",disabled:h.value===1,onClick:e[4]||(e[4]=a=>h.value--),small:""},null,8,["disabled"]),s("span",null,"Página "+l(h.value)+" de "+l(E.value),1),m(b,{label:"Siguiente »",disabled:h.value===E.value,onClick:e[5]||(e[5]=a=>h.value++),small:""},null,8,["disabled"])])])]),s("div",le,[m(b,{color:"success",label:"Asignar hijo",onClick:M}),m(b,{color:"gray",label:"Cancelar",onClick:F})]),r.value?(u(),p("div",re,[s("h2",ne,[e[10]||(e[10]=J(" Hijos Asignados a ")),s("span",de,l(r.value.persona_rol.persona.nombres_persona)+" "+l(r.value.persona_rol.persona.apellidos_pat),1)]),s("div",ie,[s("table",ue,[e[11]||(e[11]=s("thead",{class:"bg-gray-100"},[s("tr",null,[s("th",{class:"px-4 py-2"},"Nombre"),s("th",{class:"px-4 py-2"},"Acción")])],-1)),s("tbody",null,[(u(!0),p($,null,P(g.value,a=>(u(),p("tr",{key:a.id_estudiante,class:"hover:bg-gray-50"},[s("td",ce,l(a.persona_rol.persona.nombres_persona)+" "+l(a.persona_rol.persona.apellidos_pat)+" "+l(a.persona_rol.persona.apellidos_mat),1),s("td",pe,[m(b,{label:"Quitar",color:"danger",small:"",onClick:t=>D(a.id_estudiante)},null,8,["onClick"])])]))),128))])])])])):j("",!0),v.value?(u(),p("div",ve,l(v.value),1)):j("",!0),c.value?(u(),p("div",_e,l(c.value),1)):j("",!0)])]),_:1}))}};export{ge as default};
