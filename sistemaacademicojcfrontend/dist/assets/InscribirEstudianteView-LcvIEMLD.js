import{l as c,m as J,p as Q,f as W,M as X,w as B,Q as Y,H as N,o as r,a as o,d as w,c as i,E as n,D as k,F as L,J as d,x as C,Y as v,L as h,n as Z,v as K,Z as I,e as V,q as ee}from"./index-B8rY39Xw.js";const oe={class:"p-6"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ae={class:"bg-white p-6 rounded shadow-md"},te={class:"flex items-center justify-between mb-4"},ne={class:"text-xl font-semibold"},le={key:0,class:"text-gray-500"},re={class:"overflow-auto max-h-[500px] border rounded"},ie={class:"min-w-full text-sm text-left"},de=["onClick"],ue={class:"px-4 py-2"},pe={class:"px-4 py-2 capitalize"},ce={class:"grid md:grid-cols-2 gap-4"},ve={class:"grid md:grid-cols-2 gap-4"},me={class:"grid md:grid-cols-2 gap-4"},_e={class:"grid md:grid-cols-2 gap-4"},fe=["value"],ge={class:"w-full px-4 py-2 border rounded bg-gray-100 text-sm"},be={class:"flex gap-4"},ye={key:0,class:"text-green-600"},xe={key:1,class:"text-red-600"},we={class:"bg-white p-6 rounded shadow-md"},ke={key:0,class:"text-gray-500"},Ce={key:1},Ve={class:"mb-4"},Ee={class:"mb-4"},Ue=["value"],Ne={key:0,class:"mb-4 text-sm text-gray-600"},qe={class:"flex gap-4"},$e={key:1,class:"mt-4 text-green-600"},Me={key:2,class:"mt-4 text-red-600"},Se={class:"mb-2"},De={class:"mt-4 flex justify-end"},Ae={__name:"InscribirEstudianteView",setup(Le){const j=c([]),A=c([]),g=c(null),m=c(null),E=c(""),y=c(""),q=c(""),x=c(!1),$=c(!1),F=c({usuario:"",password:"admin123"}),_=J({estudiante_id:"",curso_id:""}),a=c({persona:{nombres_persona:"",apellidos_pat:"",apellidos_mat:"",sexo_persona:"",fecha_nacimiento:"",direccion_persona:"",nacionalidad_persona:"",celular_persona:"",fotografia_persona:null},documento:{carnet_identidad:"",certificado_nacimiento:""},estudiante:{rude:"",libreta_anterior:"",obsev_estudiante:""},inscripcion:{cursos_id_curso:"",gestiones_id_gestion:""}}),M=c(""),U=c(""),O=async()=>{try{const t=await N.get("/info/estudiantes"),e=await N.get("/cursos"),u=await N.get("/gestiones");g.value=u.data.data.find(p=>p.estado_gestion==="activa"),j.value=t.data.estudiantes.filter(p=>!p.cursos.some(l=>{var s;return l.gestiones_id_gestion===((s=g.value)==null?void 0:s.id_gestion)&&l.estado==="inscrito"})),A.value=e.data.data}catch(t){console.error(t),y.value="Error al cargar datos"}};Q(O);const R=t=>{m.value=t,_.estudiante_id=t.id_estudiante,_.curso_id="",E.value="",y.value=""},G=async()=>{var t,e;if(!_.estudiante_id||!_.curso_id||!g.value){y.value="Completa todos los campos antes de inscribir.";return}try{const u={estudiantes_id_estudiante:_.estudiante_id,cursos_id_curso:_.curso_id,gestiones_id_gestion:g.value.id_gestion},p=await N.post("/inscribir-curso",u);E.value=p.data.message,y.value="",m.value=null,O()}catch(u){console.error(u),y.value=((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||"Error al inscribir estudiante",E.value=""}},T=W(()=>{if(!q.value)return j.value;const t=q.value.toLowerCase();return j.value.filter(e=>{const u=e.persona_rol.persona.nombres_persona.toLowerCase(),p=e.persona_rol.persona.apellidos_pat.toLowerCase(),l=e.persona_rol.persona.apellidos_mat.toLowerCase();return u.includes(t)||p.includes(t)||l.includes(t)})}),z=async()=>{var e,u,p;if(!g.value){U.value="No hay gestión activa definida.";return}const t=a.value;t.inscripcion.cursos_id_curso?t.inscripcion.gestiones_id_gestion=g.value.id_gestion:t.inscripcion={};try{const l=new FormData;console.log("Tipo de fotografia_persona:",t.persona.fotografia_persona);for(const[b,f]of Object.entries(t.persona))f!=null&&l.append(`persona[${b}]`,f);for(const[b,f]of Object.entries(t.documento))l.append(`documento[${b}]`,f);for(const[b,f]of Object.entries(t.estudiante))l.append(`estudiante[${b}]`,f);for(const[b,f]of Object.entries(t.inscripcion))f&&l.append(`inscripcion[${b}]`,f);const s=await N.post("/inscribir-estudiante",l,{headers:{"Content-Type":"multipart/form-data"}});M.value=s.data.message,U.value="",x.value=!1,O();const S=a.value.persona.nombres_persona.trim().split(" ")[0]||"",D=a.value.persona.apellidos_pat.trim()||"";F.value.usuario=`${S}${D}`.toLowerCase(),$.value=!0,P()}catch(l){console.error(l),console.log((e=l.response)==null?void 0:e.data),U.value=((p=(u=l.response)==null?void 0:u.data)==null?void 0:p.message)||"Error al registrar estudiante",M.value=""}},P=()=>{a.value={persona:{nombres_persona:"",apellidos_pat:"",apellidos_mat:"",sexo_persona:"",fecha_nacimiento:"",direccion_persona:"",nacionalidad_persona:"",celular_persona:"",fotografia_persona:null},documento:{carnet_identidad:"",certificado_nacimiento:""},estudiante:{rude:"",libreta_anterior:"",obsev_estudiante:""},inscripcion:{cursos_id_curso:"",gestiones_id_gestion:""}}},H=t=>{const e=t.target.files[0];e&&e.type.startsWith("image/")&&(a.value.persona.fotografia_persona=e)};return(t,e)=>(r(),X(Y,null,{default:B(()=>{var u,p,l;return[o("div",oe,[e[32]||(e[32]=o("h1",{class:"text-2xl font-bold mb-6"},"Inscripción de Estudiantes",-1)),o("div",se,[o("div",ae,[o("div",te,[o("h2",ne,n(x.value?"Registrar nuevo estudiante":"Estudiantes sin curso"),1),w(k,{label:x.value?"Ver lista":"Registrar nuevo estudiante",color:"info",size:"sm",onClick:e[0]||(e[0]=()=>{x.value=!x.value,m.value=null,_.estudiante_id="",_.curso_id=""})},null,8,["label"])]),x.value?(r(),i("form",{key:1,onSubmit:K(z,["prevent"]),class:"space-y-4"},[o("div",ce,[d(o("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.persona.nombres_persona=s),type:"text",placeholder:"Nombres",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.nombres_persona]]),d(o("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.persona.apellidos_pat=s),type:"text",placeholder:"Apellido paterno",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.apellidos_pat]]),d(o("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.persona.apellidos_mat=s),type:"text",placeholder:"Apellido materno",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.apellidos_mat]]),d(o("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.persona.sexo_persona=s),class:"w-full px-4 py-2 border rounded",required:""},e[22]||(e[22]=[o("option",{value:""},"Seleccionar sexo",-1),o("option",{value:"Masculino"},"Masculino",-1),o("option",{value:"Femenino"},"Femenino",-1)]),512),[[I,a.value.persona.sexo_persona]]),d(o("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.value.persona.fecha_nacimiento=s),type:"date",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.fecha_nacimiento]]),d(o("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value.persona.direccion_persona=s),type:"text",placeholder:"Dirección",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.direccion_persona]]),d(o("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>a.value.persona.nacionalidad_persona=s),type:"text",placeholder:"Nacionalidad",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.persona.nacionalidad_persona]]),d(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>a.value.persona.celular_persona=s),type:"text",placeholder:"Celular",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.persona.celular_persona]]),o("input",{type:"file",accept:"image/*",onChange:H,class:"w-full px-4 py-2 border rounded"},null,32)]),o("div",ve,[d(o("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>a.value.documento.carnet_identidad=s),type:"text",placeholder:"Carnet de Identidad",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.documento.carnet_identidad]]),d(o("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.documento.certificado_nacimiento=s),type:"text",placeholder:"Certificado de Nacimiento",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.documento.certificado_nacimiento]])]),o("div",me,[d(o("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.estudiante.rude=s),type:"text",placeholder:"RUDE",class:"w-full px-4 py-2 border rounded",required:""},null,512),[[v,a.value.estudiante.rude]]),d(o("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.estudiante.libreta_anterior=s),type:"text",placeholder:"Libreta anterior",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.estudiante.libreta_anterior]]),d(o("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>a.value.estudiante.obsev_estudiante=s),type:"text",placeholder:"Observaciones",class:"w-full px-4 py-2 border rounded"},null,512),[[v,a.value.estudiante.obsev_estudiante]])]),o("div",_e,[d(o("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>a.value.inscripcion.cursos_id_curso=s),class:"w-full px-4 py-2 border rounded"},[e[23]||(e[23]=o("option",{value:""},"Selecciona curso (opcional)",-1)),(r(!0),i(L,null,h(A.value,s=>(r(),i("option",{key:s.id_curso,value:s.id_curso},n(s.grado_curso)+" "+n(s.paralelo_curso)+" - "+n(s.nivel_educativo.codigo),9,fe))),128))],512),[[I,a.value.inscripcion.cursos_id_curso]]),o("div",ge,[e[24]||(e[24]=o("span",null,"Gestión:",-1)),o("strong",null,n(((u=g.value)==null?void 0:u.nombre_gestion)||"No disponible"),1)])]),o("div",be,[w(k,{type:"submit",label:"Registrar",color:"success"}),w(k,{type:"button",label:"Cancelar",color:"secondary",onClick:e[16]||(e[16]=s=>x.value=!1)})]),M.value?(r(),i("div",ye,n(M.value),1)):C("",!0),U.value?(r(),i("div",xe,n(U.value),1)):C("",!0)],32)):(r(),i(L,{key:0},[d(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>q.value=s),placeholder:"Buscar por nombre o apellido",class:"w-full mb-4 px-4 py-2 border rounded shadow-sm"},null,512),[[v,q.value]]),T.value.length===0?(r(),i("div",le," No hay estudiantes encontrados ")):C("",!0),o("div",re,[o("table",ie,[e[21]||(e[21]=o("thead",{class:"bg-gray-100 sticky top-0"},[o("tr",null,[o("th",{class:"px-4 py-2 font-medium text-gray-600"},"Nombre completo"),o("th",{class:"px-4 py-2 font-medium text-gray-600"},"Estado")])],-1)),o("tbody",null,[(r(!0),i(L,null,h(T.value,s=>{var S,D;return r(),i("tr",{key:s.id_estudiante,onClick:b=>R(s),class:Z(["cursor-pointer border-b",((S=m.value)==null?void 0:S.id_estudiante)===s.id_estudiante?"bg-green-100 font-semibold":"hover:bg-gray-100"])},[o("td",ue,n(s.persona_rol.persona.nombres_persona)+" "+n(s.persona_rol.persona.apellidos_pat)+" "+n(s.persona_rol.persona.apellidos_mat),1),o("td",pe,n(((D=s.cursos[0])==null?void 0:D.estado)||"No inscrito"),1)],10,de)}),128))])])])],64))]),o("div",we,[e[31]||(e[31]=o("h2",{class:"text-xl font-semibold mb-4"},"Asignar curso",-1)),m.value?(r(),i("div",Ce,[o("div",Ve,[o("p",null,[e[25]||(e[25]=o("strong",null,"Nombre:",-1)),V(" "+n(m.value.persona_rol.persona.nombres_persona)+" "+n(m.value.persona_rol.persona.apellidos_pat)+" "+n(m.value.persona_rol.persona.apellidos_mat),1)]),o("p",null,[e[26]||(e[26]=o("strong",null,"CI:",-1)),V(" "+n(((p=m.value.persona_rol.persona.documento)==null?void 0:p.carnet_identidad)||"---"),1)]),o("p",null,[e[27]||(e[27]=o("strong",null,"Estado:",-1)),V(" "+n(((l=m.value.cursos[0])==null?void 0:l.estado)||"no_inscrito"),1)])]),o("div",Ee,[e[29]||(e[29]=o("label",{class:"block font-medium mb-1"},"Selecciona curso",-1)),d(o("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>_.curso_id=s),class:"w-full border px-4 py-2 rounded shadow-sm"},[e[28]||(e[28]=o("option",{value:""},"Seleccionar",-1)),(r(!0),i(L,null,h(A.value,s=>(r(),i("option",{key:s.id_curso,value:s.id_curso},n(s.grado_curso)+" "+n(s.paralelo_curso)+" - "+n(s.nivel_educativo.codigo),9,Ue))),128))],512),[[I,_.curso_id]])]),g.value?(r(),i("div",Ne,[e[30]||(e[30]=V(" Gestión activa: ")),o("strong",null,n(g.value.nombre_gestion),1)])):C("",!0),o("div",qe,[w(k,{color:"success",label:"Inscribir",onClick:G}),w(k,{color:"info",outline:"",label:"Cancelar",onClick:e[18]||(e[18]=s=>m.value=null)})]),E.value?(r(),i("div",$e,n(E.value),1)):C("",!0),y.value?(r(),i("div",Me,n(y.value),1)):C("",!0)])):(r(),i("div",ke," Selecciona un estudiante para continuar. "))])])]),w(ee,{modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=s=>$.value=s),title:"ALUMNO CREADO EXITOSAMENTE","hide-footer":!0},{default:B(()=>[o("p",Se,[e[33]||(e[33]=V(" Usuario generado: ")),o("strong",null,n(F.value.usuario),1)]),o("p",null,[e[34]||(e[34]=V(" Contraseña predeterminada: ")),o("strong",null,n(F.value.password),1)]),o("div",De,[w(k,{color:"primary",label:"Aceptar",onClick:e[19]||(e[19]=s=>$.value=!1)})])]),_:1},8,["modelValue"])]}),_:1}))}};export{Ae as default};
