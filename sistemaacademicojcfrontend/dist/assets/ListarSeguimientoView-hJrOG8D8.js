import{a4 as te,a5 as le,a6 as se,a7 as oe,a8 as ne,a9 as ie,aa as re,l as r,p as de,f as m,O as ue,M as I,w as ce,Q as ve,H as L,o as s,a as t,c as o,x as z,J as O,Y as pe,E as n,F as x,L as h,d as w,D as k,e as A,Z as me,n as _e,u as ge,ab as be}from"./index-Z_uBy7-W.js";const fe={class:"p-6 space-y-6"},xe={key:0},he={class:"flex flex-col md:flex-row md:items-center md:gap-4 my-4"},ye={key:0,class:"text-gray-500"},we={key:1,class:"text-red-600"},ke={key:2,class:"w-full text-left bg-white rounded shadow"},Se={class:"p-2"},Ce={class:"p-2"},De={class:"p-2"},Me={class:"p-2"},Ee={class:"p-2"},$e={class:"p-2"},Ne={key:0},Le={key:3,class:"flex justify-center items-center gap-2 mt-4"},Ae={key:1},Be={class:"text-xl font-bold"},Re={class:"p-4 bg-orange-50 border border-orange-200 rounded-xl shadow-md"},Pe={class:"mt-4"},Ve=["value"],Fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4"},je={class:"p-4 bg-yellow-50 border border-yellow-200 rounded-xl shadow-md"},Ie={class:"flex justify-between items-center mb-4"},ze={class:"font-semibold text-yellow-800"},Oe={class:"grid grid-cols-7 text-center text-xs text-gray-600 mb-2"},Ue={class:"grid grid-cols-7 text-center"},Ye=["onClick","disabled"],Te={class:"p-4 bg-blue-50 border border-blue-200 rounded-xl shadow-md flex flex-col"},Je={class:"text-lg font-semibold text-blue-700 mb-4 text-center"},Ze={key:0,class:"flex-1"},He={key:1,class:"text-center text-gray-500"},Qe={class:"mt-6 text-left"},B=10,Ke={__name:"ListarSeguimientoView",setup(qe){te.register(le,se,oe,ne,ie,re);const y=r(""),S=r([]),C=r(!0),D=r(null),_=r(1),d=r(null),b=r([]),M=r([]),p=r(null),u=r(""),i=r(new Date().getMonth()),c=r(new Date().getFullYear()),U=["LU","MA","MI","JU","VI","SA","DO"],Y=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],E=[{name:"asistencia",label:"Asistencia"},{name:"participacion",label:"Participación"},{name:"disciplina",label:"Disciplina"},{name:"puntualidad",label:"Puntualidad"},{name:"respeto",label:"Respeto"},{name:"tolerancia",label:"Tolerancia"},{name:"estado_animo",label:"Estado Ánimo"}],v=r({asistencia:0,participacion:0,disciplina:0,puntualidad:0,respeto:0,tolerancia:0,estado_animo:0});async function T(){try{const l=await L.get("/info/estudiantes");S.value=(l.data.estudiantes||[]).filter(e=>e.cursos.some(a=>a.estado==="inscrito"&&a.gestion.estado_gestion==="activa")).map(e=>{const a=e.persona_rol.persona,f=e.cursos.find(j=>j.estado==="inscrito"&&j.gestion.estado_gestion==="activa"),g=f==null?void 0:f.curso;return{id_estudiante:e.id_estudiante,apellidos_pat:a.apellidos_pat,apellidos_mat:a.apellidos_mat,nombres:a.nombres_persona,nombre_completo:`${a.apellidos_pat} ${a.apellidos_mat} ${a.nombres_persona}`,curso:g?`${g.grado_curso} ${g.paralelo_curso}`:"—",nivel_educativo:g==null?void 0:g.nivel_educativo}})}catch{D.value="Error al cargar estudiantes"}finally{C.value=!1}}de(T);const R=m(()=>y.value?S.value.filter(l=>[l.apellidos_pat,l.apellidos_mat,l.nombres,l.curso].some(e=>e.toLowerCase().includes(y.value.toLowerCase()))):S.value),$=m(()=>Math.ceil(R.value.length/B)),P=m(()=>{const l=(_.value-1)*B;return R.value.slice(l,l+B)});async function J(l){d.value=l,p.value=null,u.value="";const e=await L.get(`/estudiantes/${l.id_estudiante}/seguimientos`);b.value=e.data.data||[];const a=await L.get(`/materias?nivel_id=${l.nivel_educativo.id}`);M.value=a.data.data||[]}const Z=m(()=>M.value.filter(l=>l.nivel_educativo_id===d.value.nivel_educativo.id));function H(){d.value=null,b.value=[],M.value=[],u.value=""}const Q=m(()=>(new Date(c.value,i.value,1).getDay()+6)%7),q=m(()=>new Date(c.value,i.value+1,0).getDate());function N(l,e,a){return`${l}-${String(e+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`}function V(l){return b.value.some(e=>e.materias_id_materia===u.value&&e.fecha_reg_seg===N(c.value,i.value,l))}function G(l){return p.value===N(c.value,i.value,l)}function K(){i.value===0?(i.value=11,c.value--):i.value--}function W(){i.value===11?(i.value=0,c.value++):i.value++}ue(u,l=>{if(!l)return;const e=b.value.filter(a=>a.materias_id_materia===l);if(e.length){F(e[0].fecha_reg_seg);const a=new Date(e[0].fecha_reg_seg);i.value=a.getMonth(),c.value=a.getFullYear()}else p.value=null,E.forEach(a=>v.value[a.name]=0)});function F(l){p.value=l;const e=b.value.find(a=>a.materias_id_materia===u.value&&a.fecha_reg_seg===l);e&&(v.value.asistencia=e.asistencia==="Sí"?5:0,v.value.participacion=e.participacion==="Alta"?5:e.participacion==="Media"?3:1,v.value.disciplina=e.disciplina==="Excelente"?5:e.disciplina==="Buena"?4:e.disciplina==="Regular"?3:1,v.value.puntualidad=e.puntualidad==="Excelente"?5:e.puntualidad==="Buena"?4:e.puntualidad==="Regular"?3:1,v.value.respeto=e.respeto==="Sí"?5:0,v.value.tolerancia=e.tolerancia==="Sí"?5:0,v.value.estado_animo=e.estado_animo==="Muy bien"?5:e.estado_animo==="Bien"?4:e.estado_animo==="Neutro"?3:e.estado_animo==="Estresado"?2:1)}const X=E.map(l=>l.label),ee=m(()=>{var l;return{labels:X,datasets:[{label:(l=d.value)==null?void 0:l.nombres,data:E.map(e=>v.value[e.name]),backgroundColor:"rgba(59,130,246,0.3)",borderColor:"rgba(59,130,246,0.8)",pointBackgroundColor:"rgba(37,99,235,0.8)",pointBorderColor:"#fff"}]}}),ae={maintainAspectRatio:!1,scales:{r:{beginAtZero:!0,min:0,max:5,ticks:{stepSize:1}}},plugins:{legend:{position:"top"}}};return(l,e)=>(s(),I(ve,null,{default:ce(()=>[t("div",fe,[d.value?(s(),o("div",Ae,[t("h2",Be," Seguimientos de "+n(d.value.nombre_completo),1),t("div",Re,[e[12]||(e[12]=t("h3",{class:"text-lg font-semibold mb-2 text-orange-800"},"Información del Estudiante",-1)),t("p",null,[e[7]||(e[7]=t("strong",null,"Nombre:",-1)),A(" "+n(d.value.nombre_completo),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Curso:",-1)),A(" "+n(d.value.curso),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Nivel Educativo:",-1)),A(" "+n(d.value.nivel_educativo.nombre),1)]),t("div",Pe,[e[11]||(e[11]=t("label",{class:"block mb-1 font-medium text-orange-800"},"Materia",-1)),O(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>u.value=a),class:"w-full px-4 py-2 border rounded"},[e[10]||(e[10]=t("option",{disabled:"",value:""},"Selecciona una materia",-1)),(s(!0),o(x,null,h(Z.value,a=>(s(),o("option",{key:a.id_materia,value:a.id_materia},n(a.area_materia),9,Ve))),128))],512),[[me,u.value]])])]),t("div",Fe,[t("div",je,[t("div",Ie,[t("button",{onClick:K,class:"p-1 rounded hover:bg-yellow-200 text-yellow-800"}," ‹ "),t("div",ze,n(Y[i.value])+" "+n(c.value),1),t("button",{onClick:W,class:"p-1 rounded hover:bg-yellow-200 text-yellow-800"}," › ")]),t("div",Oe,[(s(),o(x,null,h(U,a=>t("div",{key:a},n(a),1)),64))]),t("div",Ue,[(s(!0),o(x,null,h(Q.value,a=>(s(),o("div",{key:"b"+a,class:"h-8"}))),128)),(s(!0),o(x,null,h(q.value,a=>(s(),o("button",{key:a,onClick:f=>F(N(c.value,i.value,a)),class:_e(["h-8 w-8 flex items-center justify-center rounded-full transition",G(a)?"bg-amber-600 text-white":V(a)?"bg-amber-100 text-amber-700 hover:bg-amber-200 cursor-pointer":"text-gray-300 cursor-default"]),disabled:!V(a)},n(a),11,Ye))),128))])]),t("div",Te,[t("h3",Je," Rendimiento en "+n(p.value||"—"),1),p.value&&u.value?(s(),o("div",Ze,[(s(),I(ge(be),{data:ee.value,options:ae,key:p.value+"-"+u.value},null,8,["data"]))])):(s(),o("div",He," Selecciona materia y fecha para ver el gráfico "))])]),t("div",Qe,[w(k,{color:"success",label:"Volver",class:"px-6 py-3 text-lg",onClick:H})])])):(s(),o("div",xe,[e[6]||(e[6]=t("h2",{class:"text-xl font-bold"},"Seleccionar Estudiante",-1)),t("div",he,[O(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),type:"text",placeholder:"Buscar por apellido o curso...",class:"w-full md:w-1/3 px-4 py-2 border rounded shadow-sm"},null,512),[[pe,y.value]])]),C.value?(s(),o("div",ye,"Cargando estudiantes…")):D.value?(s(),o("div",we,n(D.value),1)):(s(),o("table",ke,[e[5]||(e[5]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"p-2"},"Apellido Paterno"),t("th",{class:"p-2"},"Apellido Materno"),t("th",{class:"p-2"},"Nombres"),t("th",{class:"p-2"},"Curso"),t("th",{class:"p-2"},"Nivel"),t("th",{class:"p-2"},"Acciones")])],-1)),t("tbody",null,[(s(!0),o(x,null,h(P.value,a=>(s(),o("tr",{key:a.id_estudiante,class:"even:bg-gray-50"},[t("td",Se,n(a.apellidos_pat),1),t("td",Ce,n(a.apellidos_mat),1),t("td",De,n(a.nombres),1),t("td",Me,n(a.curso),1),t("td",Ee,n(a.nivel_educativo.nombre),1),t("td",$e,[w(k,{color:"info",label:"Seleccionar",small:"",onClick:f=>J(a)},null,8,["onClick"])])]))),128)),!P.value.length&&!C.value?(s(),o("tr",Ne,e[4]||(e[4]=[t("td",{colspan:"6",class:"p-4 text-center text-gray-500"}," No hay estudiantes para mostrar. ",-1)]))):z("",!0)])])),$.value>1?(s(),o("div",Le,[w(k,{label:"« Anterior",disabled:_.value===1,small:"",onClick:e[1]||(e[1]=a=>_.value--)},null,8,["disabled"]),t("span",null,"Página "+n(_.value)+" de "+n($.value),1),w(k,{label:"Siguiente »",disabled:_.value===$.value,small:"",onClick:e[2]||(e[2]=a=>_.value++)},null,8,["disabled"])])):z("",!0)]))])]),_:1}))}};export{Ke as default};
